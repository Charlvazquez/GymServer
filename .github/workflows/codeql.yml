name: Validacion de aplicacion ###Se anexa el nombre de la accion

on: ### -> Se agrega el trigger del workflow
  push: ### -> Se anexa los push y pull request asi como las ramas en donde se realizan
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

### Se van agregar las ejecuciones que se realicen en el workflow
jobs: 
  validate: ## Primero que valide que se ejecute la version de ubuntu para nuestra aplicacion en este caso la ultima version
    runs-on: ubuntu-latest
    
    steps: ## Se van agregar los pasos que se van a realizar
    - name: Checkout code
      uses: actions/checkout@v4 ###sta acción descarga el repositorio en el ejecutor,
      ### lo que permite ejecutar scripts u otras acciones sobre el código (como herramientas de compilación y prueba).

    - name: Setup PHP
      uses: shivammathur/setup-php@v2  ###Se anexa la extension de php.
      with:
        php-version: '8.1' ##Una vez anexada la extension de php, se define que version de php va a utilizar.

    - name: Find composer.json file
      run: | ###Este script servira para buscar el archivo composer.json que se almaneceno en la carpeta de nuestro workflow
        echo "Buscando composer.json en el repositorio..."
        find . -name "composer.json" -type f

    - name: Validate composer.json (si existe)
      ###Este script va a confirmar si existe el archivo composer.json.
      ###En caso de que no lo encuentre se va a buscar en subdirectorios###
      run: | 
        if [ -f "composer.json" ]; then
          echo "Validando composer.json en raíz..."
          composer validate --no-check-all
        else
        
          echo "No hay composer.json en la raíz, buscando en subdirectorios..."
          find . -name "composer.json" -type f -exec dirname {} \; | head -1 | while read dir; do
            echo "Validando composer.json en: $dir"
            cd "$dir"
            composer validate --no-check-all
            cd -
          done
        fi

    - name: Check PHP syntax in entire project
      run: | ###Se anexa el script para validar la sintaxis de php
        find . -name "*.php" -exec php -l {} \;
